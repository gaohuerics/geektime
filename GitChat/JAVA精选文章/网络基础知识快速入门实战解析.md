### 内容提要

内容提要：

- http和https有什么区别？
- http如何传输视频文件或者视频流？
- 理解tcp ip对编程，对日常工作的作用体现在什么地方？
- 怎么防止web网络抓包，使用https是不就可以防抓？
- 集群对单个服务器的心跳机制，常用的协议是什么？使用本专题介绍的协议是否可行？如果可以其优势体现在哪里，不行的话缺点是什么？
- QUIC主要应用场景有哪些？相比于这些场景以前的解决方案有何优势？
- 请问学习http相关知识的学习，对于其他语言比如java等从业者是否有必要？会有哪些影响？
- tcp、ip、http和socket之间的联系是什么？
- 全栈https的部署有什么难点吗 ？为什么建设银行仅有登录做了https 而不是全栈https？
- tcp和udp的区别有哪些？
- 请问TCP/IP对于测试人员需要掌握哪些知识点？
- DNS反劫持都有哪些措施？
- 可靠ＵＤＰ的重送机制如何设计在网路壅塞的时候效果会比较好？
- 网路状况的好坏是如何判定的？
- 请问chromium优化是如何进行网络优化的？
- 麻烦讲一下数字签名、数字证书、SSL可以吗？
- 很多人都觉得TCP/IP艰深难懂，请问你是怎么样学习TCP/IP的？
- https对服务器资源消耗怎么样？

------

**问：http和https有什么区别？**

**答：** 可以简单认为https = http + tls。https是一种安全的加密传输协议，而http则是不加密的协议，因此https更加安全 在我们平时访问中，也可以看到浏览器的左上角的提示。

![enter image description here](http://images.gitbook.cn/265f8090-ca10-11e7-b314-a5a32543eda8)

目前大部分网站都已经全量HTTPS了。

------

**问：http如何传输视频文件或者视频流？**

**答：** 对于流媒体传输，如果用http的话，一般是用hls协议，也就是HTTP Live Streaming协议。HLS协议是一个由苹果公司提出的基于HTTP的流媒体网络传输协议，它的原理是讲整个流分成一个个小的模块进行传输和下载的。

------

**问：理解TCP/IP对编程，对日常工作的作用体现在什么地方？**

**答：** 对于解决网络相关问题非常有用，一些比较常见的内核参数优化，比如我们要优化服务器的time-wait。

`tcp_tw_reuse = 1` 表示开启重用。允许将time-wait sockets重新用于新的TCP连接，默认为0，表示关闭；

`tcp_tw_recycle = 1` 表示开启TCP连接中time-wait sockets的快速回收，默认为0，表示关闭。

这样的例子还有很多，一般服务端的内核参数，如果没有一定的TCP/IP基础的话，很难准确地去理解，更不用说去优化了，并且我们也注意到，在很多公司的研发岗位招聘要求中，通常都要求应聘者具备TCP/IP方面的知识，甚至是精通。

------

**问：怎么防止Web网络抓包，使用https是不就可以防抓？**

**答：** HTTPS可以有效防止网络恶意抓包，但是由于成本原因，或者说HTTPS请求失败后，我们不可能完全全量的使用HTTPS，这个时候我们就需要在客户端对报文进行加密，然后在LB层或服务端进行解密。

------

**问：集群对单个服务器的心跳机制，常用的协议是什么？使用本专题介绍的协议是否可行？如果可以其优势体现在哪里，不行的话缺点是什么？**

**答：** 其实TCP已经有心跳机制，在一个集群下的不同服务之间也是通过这个心跳机制来实现通信，保证服务的可用性。之前在华为工作时，路由器集群之间的心跳报文是华为自己定制的一套体系，为了保证路由表和MAC表的正常转发，多台路由器之间存在心跳机制，这个机制是建立在IP层面上的，但是不具有通用性。

------

**问：QUIC主要应用场景有哪些？相比于这些场景以前的解决方案有何优势？**

**答：** 目前谷歌已经开始广泛上quic，前不久腾讯云也宣布拥抱变化，支持quic。Google在YouTube上部署后有数据显示，视频缓冲卡顿少了30%， 用户体验得到了非常大的提升，其它一些已经部署了QUIC协议的网站，传输速度也有一定的提升。

QUIC相比传统的HTTP传输，有以下的优势：

1. 建立连接快，除了首次建立连接需要1-RTT之外，其余的连接建立均是0—RTT，别小看一个RTT（往返时延），如果在弱网环境下，也要几百毫秒，这已经是一个非常大的优化了。
2. 采用UDP传输，UDP速度比TCP要快，同时QUIC还提供像TCP一样的稳定传输。
3. 采用流传输，当用户的五元组(目的ip、源ip、目的端口、源端口和上层协议)任一一个发生变化时，不需要再重新建立连接，QUCI可以直接进行切换，节省了不少时间。

------

**问：请问学习http相关知识的学习，对于其他语言比如java等从业者是否有必要？会有哪些影响？**

**答：** 首先语言和网络知识的学习并不冲突，拿武功来说，语言相当于是一门招式，而网络知识则是内功基础，试想一下，如果你作为一个后端java开始，遇上网络问题却一窍不通，那处理问题起来会多么僵硬。

------

**问：tcp、ip、http和socket之间的联系是什么？**

**答：** ip是网络层协议，上层的传输层是tcp，在上层的应用层协议是http，这是最为常见的一种报文形式了，在我们的文章中，也提到了，你去抓一个http报文，其层次就是这样的。

但实际上http协议并没有规定其传输层协议一定是tcp，你可以用udp封装进行传输，理论上行得通，但为什么不这么做？这是因为udp不提供可靠的传输服务，而tcp提供。而socket可以看做是源ip、目的ip、源端口、目的端口以及所在协议的五元组，平时我们也有关于socket的编程，这个时候实际上就是你提供这个五元组内的信息，再调用系统提供的socket接口，便可以完成服务端和客户端的传输。

------

**问：全栈https的部署有什么难点吗 ？为什么建设银行仅有登录做了https 而不是全栈https？**

**答：** 全栈https最大的问题就在于成本，因为https协议需要服务器或者云端的支持，并且加解密也存在资源上的大量开销。我们文章中，某些网站之所以没有全量https，是因为有些业务不是那么看重安全性或者说这部分业务及时被截获也影响不大，一般很多网站或app的log都还是采用http传输。

------

**问：tcp和udp的区别有哪些？**

**答：** 简单点讲，udp协议更为轻量，不提供可靠的传输服务。而tcp则提供可靠的，基于连接的字节流服务，因此它的报文头也更长，一般为20字节，而udp只有8字节。再延伸下，quic协议采用udp协议，也是看中udp更为轻量和便捷，当然quic在应用层做了传输保证，因此其才具备又快又准的特性。

------

**问：请问 TCP/IP 对于测试人员需要掌握哪些知识点？**

**答：** 测试人员的话：

1. 抓包是必须的，各种抓包软件必须使用的十分熟练；
2. 会看报文，抓包完以后，要会分析报文，至少要熟悉http报文头的一些关键字段都是什么意思；
3. 能够熟练掌握tcp状态迁移图，也就是文章中提到的，对于连接的建立和断开过程要很熟练，必要时还要上开发机看这些连接的状态。

------

**问：DNS反劫持都有哪些措施呢？**

**答：** 一般来说DNS反劫持有几种有效的做法：

1. 域名对应多个IP地址，这样即使一个IP被劫持，也还有一个备用的IP地址，不至于导致服务完全瘫痪。
2. 利用HTTPDNS替代系统自带的DNS解析，HTTPDNS是近几年比较常用的DNS反劫持手段，顾名思义，它是用HTTP协议来进行DNS解析的，这样做的好处有：HTTP协议传输层采用的是TCP协议，而系统自带的DNS解析走的则是UDP协议，TCP比UDP靠谱很多，另外HTTP协议可以做到更为精准的调度和即时性。之前提到DNS解析中有一个重要参数TTL，也就是说如果你想修改DNS解析结果，通过传统改IP的方式，解析结果必须要在TTL后才能生效，而HTTPDNS则灵活很多。

目前提供HTTPDNS服务的厂商中，最大的当属阿里云和DNSPod了，有这方面需求的同学可以关注一下。

------

**问：可靠ＵＤＰ的重送机制如何设计在网路壅塞的时候效果会比较好？**

**答：** 重传机制的话，有以下几个思路：

1. 利用tcp的指数退避，在需要重传时，根据重传次数，通过1s，2s，4s这样的方式依次类推，来进行重传；
2. 上述方式存在一定的弊端，那就是没有考虑网络的情况，特别是在弱网或者是网络情况较差的情况下，反复重试，实际上只会更加加剧报文的拥塞，因此在设计重传时，一定要考虑网络情况，简单点说就是动态监测当前带宽占用率，根据监测数据，来选取重传的时间间隔和时机。

------

**问：网路状况的好坏是如何判定的？**

**答：** 网络情况的监测实际上还是比较困难的，利用ping的方式，也只能是看到对于某个ip的访问延迟而已。如果是服务器端的网络情况，建议可以利用一些监控平台，来实时进行监控。而对于客户端的网络情况，目前我们是通过利用chromium内核中的net库中的日志记录模块，定点采样用户的请求过程，记录每一步的网络情况和用时，然后再进行分析和处理。

------

**问：请问chromium优化是如何进行网络优化的？**

**答：** chromium是chrome浏览器背后的内核引擎，其中有专门的net库来进行网络处理和优化，就拿DNS来说，chromium并不是直接采用底层的dns解析函数，而是自己通过进程调度来实现这一过程，还有就是chromium支持多种协议，之前提到的quic也是chrome发明，自然在chromium中也有体现，同时还有上一题中提到的连接日志，可以详细记录一个完整请求下的各种过程的耗时，比如说DNS解析，tcp连接以及tls握手等等。

------

**问：麻烦你讲一下数字签名、数字证书、SSL可以吗？**

**答：** 好的，数字签名简单点说就是传输过程中，发送者提供的一种不可伪造的证明。而数字证书，我们在访问一些网站时，会要求我们下载证书才能访问，相当于就是一种身份的象征。SSL协议作为一种加密协议，包括握手，还有数据传输。

在HTTPS协议中的握手协议指的就是SSL握手，这里的过程大致是：

1. client_hello：客户端发起请求；
2. server_hello：服务端返回协商的信息结果；
3. 证书校验；
4. 合法性验证通过之后，客户端计算产生随机数字Pre-master，并用证书公钥加密，发送给服务器；
5. 服务器用私钥解密加密的Pre-master数据；
6. 握手结束。

------

**问：很多人都觉得TCP/IP艰深难懂，请问你是怎么样学习TCP/IP的？**

**答：** 我觉得是一个循序渐进的过程，主要是先从最基础的TCP/IP的书籍，然后就是尽量能够在实践中去利用。可能和我的工作经历有关，第一份工作就是在华为，接触的就是底层的二层转发和三层路由，所以必须去学习这些网络知识，目前这份工作也是做网络调度和客户端网络优化的。另外网络问题的处理，比如说一些线上问题，可以非常快速地帮你提升网络知识素养。

------

**问：https对服务器资源消耗怎么样？**

**答：** 我们目前https的解析是放在腾讯云和阿里云上面的，量大概是95%左右，主要是https增加了握手次数，并且握手失败以后，还需要fallback到http，其实更多的是这部分的处理。这里的话，本身就多了三次握手，2个RTT，而且移动端网络变化复杂，即便是长连接，也存在连接的反复建立，因此损耗还是不少的。



### 文章实录

### 前言

在写之前，先给这篇文章做一个明确定位，读完这篇文章后，希望你能够：

- 对于计算机网络有初步的认识和了解，了解一些经典专业术语，如三次握手、四次挥手、DNS解析的含义。
- 了解一些应用层协议，如传统的HTTP、HTTPS协议，以及业界近几年开始逐步普及的HTTP2、QUIC协议。
- 通过实际生产环境下的例子，了解网络优化在项目中的实际意义以及带来的效果。

### 课前准备

为了能够更好地理解这篇文章的内容，建议阅读之前做以下几个准备：

- 了解TCP/IP的基本概念，推荐去阅读《TCP/IP协议详解》中的第3章和第17章，这里给大家一个链接，可以免费下载，[传送门](http://download.csdn.net/download/u012155923/10046395)。
- 其次希望在学习的过程中，为了能够更好地看到效果，请下载抓包工具，这里推荐的是[Wireshark](https://www.wireshark.org/download.html)和[Charles](https://www.charlesproxy.com/download/)，大家可以下载后，结合文章内容并尝试抓包，更容易理解整个网络转发过程。

### 网络模型

在学习具体知识前，搞清楚它所在的知识体系和模型是非常重要的，对于网络知识亦是如此，目前公认的网络模型有两种，一种是OSI七层模型，另一种则是TCP/IP五层模型，请看下图：

![enter image description here](http://images.gitbook.cn/257d9de0-b96e-11e7-a6d0-5d01521b8fe9)

可以看到，OSI七层模型和TCP/IP五层模型存在一个对应关系，并且传输层以下的完全一致(TCP模型中的网络接口层就是数据链路层和物理层的集合)，因此可以说将OSI模型中的会话层、表示层与应用层合并为TCP/IP模型中的应用层后，二者基本一致。

上述两个网络模型都属于通用网络模型，相对来说，TCP/IP模型更为普遍一些，所以我们也主要以TCP/IP模型为网络模型开展论述，这也是为什么这节课的名字TCP/IP的由来。

那么每一层都对应哪些协议呢？请看下图：

![enter image description here](http://images.gitbook.cn/caad36e0-b96e-11e7-b299-8b1207391480)

可以看到，我们熟知的一些协议，IP协议位于网络层，TCP协议位于传输层，而HTTP协议则位于应用层，其余还有比较熟悉的DNS协议，FTP协议等等，都有其所属的层级。

![enter image description here](http://images.gitbook.cn/a764db50-b970-11e7-bc24-cdc29a21f7b5)

我们可以通过Wireshark抓包验证这一点，随便抓取一个HTTP报文：

![enter image description here](http://images.gitbook.cn/4a06c490-b971-11e7-a6d0-5d01521b8fe9)

从上往下依次是Frame帧头、以太帧头、IP协议头、TCP协议头和HTTP协议头，最后的一行则是本次请求的数据，其格式为JSON

### 三握四挥

所谓三握四挥是指三次握手和四次挥手，也就是TCP协议建立连接和断开连接的过程，之所以叫做三次握手，是因为建立连接的双方需要经过三次数据交互以后才能完成连接的建立，同样的，四次挥手是指在断开连接时需要四次数据交互，其交互过程图如下：

![enter image description here](http://images.gitbook.cn/37eea2d0-ba22-11e7-8ea2-5197cc7630bf)

举个简单的例子，两个人小S和小C打电话，他们的三次握手建立连接过程就是：

> 小S：喂，是小C么？ 小C：嗯嗯是的，你是小S么？ 小S：是的是的，咱们开始愉快的聊天吧！

而四次挥手的过程则是：

> 小S：喂，小C，我有点累啦，今天要不就这样吧 小C：好呀，你休息下，我再说两句 小C：哎呀，我也好累呀，今天就到这里吧 小S：好，那就到这吧，886

然后小S和小C就挂了电话，我们注意到，在四次挥手的过程中，小S先提出了断开连接，但实际上他们的对话并没有结束，后面小C确认这个消息后，并没有立马断开连接，而是继续对话，这是因为TCP协议具备全双工特性，简单点说就是一个连接，存在小C——小S和小S到小C两条线路，而小S提出并由小C确认关闭的只是小S——小C这条线路，因此小C还可以继续向小S发消息，直到小C也觉得要关闭连接并由小S确认后，两人的所有连接才彻底关闭。

那么你肯定会问啦，为什么TCP要这么设计呢，这是因为TCP是一个全双工的协议，全双工(Full Duplex)是通讯传输的一个术语。通信允许数据在两个方向上同时传输，我们在上面的例子也提到了在一次TCP交互中，需要维持两条线路，因此无论是在建立和断开的时候，都要确保两条线路的状态正确。

上面的阐述还是建立在理论阶段，为了能更好地巩固知识，我们利用Wireshark在实际生产环境下抓包看下:

> 客户端IP为：10.2.203.93 服务端IP为：10.108.21.2

客户端和服务端建立连接时的抓包情况：

![enter image description here](http://images.gitbook.cn/4f923320-c044-11e7-bcd2-f17bd3b19ac7)

可以看到由客户端首先发SYN报文，服务端收到并回应SYN ACK报文，客户端最后再回一个ACK报文，连接就算建立完毕了。

再来看看断开连接时的情况：

![enter image description here](http://images.gitbook.cn/7eb46f00-c045-11e7-bcd2-f17bd3b19ac7)

和建立连接时不同，断开连接的发起者是服务端，可以看到服务端发送FIN报文，然后客户端再发ACK报文，此时服务端便不再向客户端传输数据，而客户端在完成数据传输后，也发送FIN报文到服务端，在收到服务端的Last ACK报文后正式断开连接。

关于TCP连接建立和断开时的三握四挥就先讲到这里，再附上一张TCP的状态迁移图，对了解整个TCP协议有很大的帮助：

![enter image description here](http://images.gitbook.cn/f5033a90-c047-11e7-a427-dd252ed6c9f0)

### DNS解析

> DNS（Domain Name System，域名系统），因特网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。通过主机名，最终得到该主机名对应的IP地址的过程叫做域名解析（或主机名解析）。

这是来源于百度百科的一段描述，简单点说DNS解析做的工作就是，让我们把能记住的，比较好记的域名转换为IP地址的一个系统，下面我们就借助Wireshark来看看它到底是怎么工作的。

我们在浏览器中输入www.baidu.com时，会向服务器发送DNS请求报文，当服务器端处理完这个请求以后，就会发送DNS响应报文，其中就包含我们关心的IP地址，可以看到我们抓到两个报文，前者我们称之为DNS请求报文，后者称之为DNS响应报文，注意我们的筛选条件，通过UDP端口来过滤更加方便：

![enter image description here](http://images.gitbook.cn/53d33d80-c11b-11e7-911a-a587ab4dd445)

先来看DNS请求报文：

![enter image description here](http://images.gitbook.cn/5eb7efc0-c11b-11e7-911a-a587ab4dd445)

可以看到DNS的传输层协议是UDP，而不是TCP，并且其端口号为53。紧接着的是Transaction ID(2字节)，这个ID可以作为DNS请求的一个唯一ID来使用，也就是说对于一个请求和应答报文，这个ID是相同的，因此也可以借助这个ID来查找请求报文相对应的应答报文。

Flags字段长度也是2字节，可以看到，16bit被分成了以下几部分，依次为：

- Response(1比特)，该值为0则说明是一个DNS请求报文，为1则说明是DNS响应报文
- opcode（4比特）：定义查询或响应的类型（若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求）。
- AA（1比特）：授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器
- TC（1比特）：截断标志位。1表示响应已超过512字节并已被截断
- RD（1比特）：该位为1表示客户端希望得到递归回答
- RA（1比特）：只能在响应报文中置为1，表示可以得到递归响应。
- zero（3比特）：不说也知道都是0了，保留字段。
- rcode（4比特）：返回码，表示响应的差错状态，通常为0和3，各取值含义如下： 0 无差错 1 格式差错 2 问题在域名服务器上 3 域参照问题 4 查询类型不支持 5 在管理上被禁止 6 -- 15 保留

紧接着Flags下面的几个字段分别是：queries、answers、auth*r、add*rr，其相应的中文含义为问题数、资源记录数、授权资源记录数和额外资源记录数，它们的长度都是2字节，一般来说queries为1，其余的字段值为0。

接下来就是报文的正文部分，这里包括要查询的域名，查询类型和相应的查询类，这里的域名的格式比较特别，在这里的域名是www.baidu.com，而标记为蓝色的部分则是报文中的表示，可以看到，03是代表3个字节，而紧跟着3个77，如果转换为ASIC码的话，就是0x77，因此对于www.baidu.com，首先是以“.”为分隔符，分成3个部分后，用相应的段长度再加上域名段的ASIC组成一个段，这样就构成了一个完整的域名。

![enter image description here](http://images.gitbook.cn/95cc2ac0-c11c-11e7-83e9-3dea33130b0c)

后续的两个字段分别是Type和Class，在这里两个字段都为1，其中Type为A则代表此次请求类型是通过域名获取IP地址，也是最为常见的一种DNS请求形式。而Class字段为1，则代表这里查询的数据是internet数据，也是最为常见的一种形式。

介绍完了请求报文，接下来再看一下响应报文：

![enter image description here](http://images.gitbook.cn/99eca4f0-c11b-11e7-911a-a587ab4dd445)

响应报文和应答报文相同的部分就不再赘述了，可以看到Flags中的Response值为1，就说明这是一个响应报文，同时Transaction ID也和请求报文中的ID一致，说明这就是上面那个请求报文所对应的响应报文。

请求报文正文中最主要的部分就是Answers字段，这里面包括了我们想要的IP地址，但是我们也注意到，对于www.baidu.com这一个域名，响应字段居然有3条，那么究竟以哪一条为准呢？我们一条条来看。

首先是第1条Answer，这里的Type类型为CNAME，这里的CNAME表示这个回应是请求报文中查询的域名的一个别名，也就是此处返回的将是www.baidu.com的一个别名，也就是www.a.shifen.com，紧接着后面两个Answer，Type类型为A，代表返回值将是一个IPV4地址，其他的比较常见的Type类型还有AAAA——IPV6地址，PTR——IP地址转换为域名，NS——名字服务器。

可以看到，对于同一个域名，可以返回多个IP地址，在上面的响应报文中，返回了2个IP地址，分别是61.135.169.125和61.135.169.121，这就是我们最终想要的结果，为了防止其中某个IP地址出现异常，因此通常对于一个域名，都会有两个甚至以上的IP地址与其对应，这样便可以起到一个主备容灾效果，当其中一个IP地址无法连接时，还可以切换到另一个IP进行访问。在浏览器中输入 或61.135.169.121，也可以正常访问页面：

![enter image description here](http://images.gitbook.cn/7161a840-c11c-11e7-97db-0db756073da4)

对于使用chrome浏览器的同学，可以输入chrome://net-internals/#dns 来查看浏览器DNS解析列表：

![enter image description here](http://images.gitbook.cn/811cfdf0-c11e-11e7-97db-0db756073da4)

在这里可以看到你访问过的网站，以及相应的解析记录，这里还有一栏TTL，代表域名解析结果的生存时间，简单点说就是当我们解析完毕一个域名以后，会将其记录缓存起来，在TTL时间之内的访问，我们都直接从缓存中获取，而不再去进行DNS解析，这样带来的好处就是减少DNS解析时间，加快网页访问速度，但同时带来的影响就是如果TTL值过大，那么如果服务器的域名解析发生变化，也需要很长时间才能在客户端生效，所以TTL要根据实际生产环境需求来调整

关于DNS的解析暂时将到这里，建议大家参照上面的抓包过程去实践一把，相信可以对整个过程有更深入的理解！

### 应用层协议

介绍完TCP协议和DNS协议之后，我们就要开始介绍处于TCP/IP模型中最上层的应用层协议了。应用层协议也是和用户交互最密切的，因此对用户感知影响也是最直接的，下面就以此介绍几种比较常见的应用层协议。

**HTTP**

> HTTP（HyperText Transport Protocol）是超文本传输协议的缩写，它用于传送WWW方式的数据，关于HTTP协议的详细内容请参考RFC2616。HTTP协议采用了请求/响应模型。客户端向服务器发送一个请求，请求头包含请求的方法、URL、协议版本、以及包含请求修饰符、客户信息和内容的类似于MIME的消息结构。服务器以一个状态行作为响应，响应的内容包括消息协议的版本，成功或者错误编码加上包含服务器信息、实体元信息以及可能的实体内容。

上面是关于HTTP的权威描述，HTTP可以说是整个互联网当中最普遍也是最重要的一个协议了，包括你现在能看到我写的这篇文章，也是利用HTTP进行数据传输的，那么纠结是如何进行工作的呢？这次我们借助另外一款抓包神器——Charles来进行抓包分析。

当我们利用浏览器访问<http://www.csdn.net/>时，浏览器会在我们输入地址并敲下回车后在页面显示：

![enter image description here](http://images.gitbook.cn/fcb059e0-c136-11e7-97db-0db756073da4)

这是一个在平常不过的操作了，此时我们用Charles进行抓包，得到下面的结果：

![enter image description here](http://images.gitbook.cn/5a4e1c40-c137-11e7-83e9-3dea33130b0c)

上面是整个完整的交互，实际上包含了两部分，首先是HTTP request请求，也就是上面中上半部分，可以看到，在request请求中几个关键点是GET、HTTP/1.1、Host、User-Agent、Accept以及Cookie，这些关键字构成了一个request请求的报文头，代表客户端想通过本次请求得到服务端的哪些数据，服务端在收到request后，作出的回应便是HTTP response报文，也就是上图中下半部分，因为我们访问的是csdn的主页，并且在Accept里也指定了html是一种请求数据，所以response报文返回的数据里便包含了HTML数据，当然，response报文也有其它组成部分，如下图所示：

![enter image description here](http://images.gitbook.cn/83a29890-c138-11e7-97db-0db756073da4)

这里面就包括了服务端对于本次请求的回应数据，其中最关键的便是200 OK这个字段，这是响应状态码，最常见的就是200，也就是表明请求OK，还有比较常见的就是404和502，前者代表客户端非法请求，后者代表服务端响应失败，比如说我们输入http://www.csdn.net/test123时，页面就会提示：

![enter image description here](http://images.gitbook.cn/285f2f00-c13a-11e7-a381-51916f53965f)

**HTTPS**

> HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）

从上面的阐述中我们可以得到HTTPS = HTTP + TLS这样一个简单的结论，也就试试哦HTTPS是比HTTP更加安全的协议，并且目前已经有不少网站开始支持HTTPS了。比如说百度：

![enter image description here](http://images.gitbook.cn/5e1140f0-c146-11e7-97db-0db756073da4)

可以看到，使用的是HTTPS协议，同时浏览器会提示安全，我们再看另外几个例子：

![enter image description here](http://images.gitbook.cn/ba431f50-c29b-11e7-b8f9-8b8f4e3d8575)

上图是工行的登陆界面，可以看到也使用了HTTPS协议，如果使用的仍然是HTTP协议，浏览器便不会有安全字样的提示：

![enter image description here](http://images.gitbook.cn/4feb8010-c29c-11e7-b8f9-8b8f4e3d8575)

哈，建行主页竟然还没有使用HTTPS协议，那是不是就说明建行不安全了呢？

其实不然，我们点击登陆按钮：

![enter image description here](http://images.gitbook.cn/77b6b9c0-c29c-11e7-b8f9-8b8f4e3d8575)

可以看到使用的协议还是HTTPS协议，这说明我们的登陆操作依然是有安全保障的，大大降低了账号信息被盗用的可能

**HTTP2**

> HTTP/2（超文本传输协议第2版，最初命名为HTTP 2.0），简称为h2（基于TLS/1.2或以上版本的加密连接）或h2c（非加密连接）[1]，是HTTP协议的的第二个主要版本，使用于万维网。
>
> HTTP/2是HTTP协议自1999年HTTP 1.1发布后的首个更新，主要基于SPDY协议。它由互联网工程任务组（IETF）的Hypertext Transfer Protocol Bis（httpbis）工作小组进行开发。[2]该组织于2014年12月将HTTP/2标准提议递交至IESG进行讨论[3]，于2015年2月17日被批准。[4]

HTTP/2标准于2015年5月以RFC 7540正式发表。[5]HTTP/2的标准化工作由Chrome、Opera、Firefox[6]、Internet Explorer 11、Safari、Amazon Silk及Edge等浏览器提供支持。[7]

多数主流浏览器已经在2015年底支持了该协议。[8]此外，根据W3Techs的数据，在2017年5月，在排名前一千万的网站中，有13.7%支持了HTTP/2。

可以看到HTTP2协议已经在互联网占有一席之地，那么它究竟比HTTP强在哪里呢？总结了一下，大致有以下几点。相比 HTTP/1.x，HTTP/2 在底层传输做了很大的改动和优化：

- 二进制传输：HTTP2 采用二进制格式传输数据，而非 HTTP 的文本格式。二进制格式在协议的解析和优化扩展上带来更多的优势和可能
- 多路复用：HTTP2 做到了并发请求。同时，流还支持优先级和流量控制。
- 服务端push：服务端能够更快的把资源推送给客户端
- 首部压缩：首部压缩使得整个HTTP2数据包小了很多，传输也就会更快

**QUIC**

> QUIC是一种新的传输 方式，与TCP相比可以减少延迟。 表面上，QUIC与在UDP上实现的TCP + TLS + HTTP / 2非常相似。由于TCP是在操作系统内核和中间件固件中实现的，所以对TCP进行重大改变几乎是不可能的。但是，由于QUIC是建立在UDP之上的，所以没有这样的限制。

QUIC相比于上述介绍的HTTP、HTTPS和HTTP2协议最大的不同就在于，其传输层采用的是UDP协议而不是TCP协议，因此其具备的特性有以下几点：

- 0-RTT 建联(首次建联除外)
- 类似TCP的可靠传输
- 类似TLS的加密传输，支持完美前向安全
- 用户空间的拥塞控制，最新的BBR算法
- 支持h2的基于流的多路复用， 但没有TCP的HOL问题
- 前向纠错FEC
- 类似MPTCP的Connection migration

那在实际环境中，如何知道哪些访问使用了HTTP2、哪些访问使用了QUIC协议呢？

这里就要提到chrome的一个插件——HTTP/2 and SPDY indicator，当下载该插件并成功访问后，我们就可以看到浏览器地址栏右侧会多一个⚡️标志：

![enter image description here](http://images.gitbook.cn/cc7c0910-c2a6-11e7-8b37-ab85a26dde69)

访问百度时，这个⚡️标志是白色的，当我们访问YouTube时：

![enter image description here](http://images.gitbook.cn/e4ce3b50-c2a6-11e7-b983-3d074aaaab5c)

会发现标志变为蓝色，鼠标移到该标志时，提示HTTP2已经使能，这说明在YouTube上面已经开始使用HTTP2协议了，在chrome浏览器中输入chrome://net-internals/#http2就可以看到具体哪些网站使用了HTTP2和QUIC：

![enter image description here](http://images.gitbook.cn/6b367ef0-c2a7-11e7-82e1-3f55aa8ff9e8)





